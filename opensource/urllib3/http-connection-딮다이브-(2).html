<!DOCTYPE html> <html><head>
		<title>HTTP Connection 딮다이브 (2)</title>
		<base href="../../">
		<meta id="root-path" root-path="../../">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes, minimum-scale=1.0, maximum-scale=5.0">
		<meta charset="UTF-8">
		<meta name="description" content="my_study - HTTP Connection 딮다이브 (2)">
		<meta property="og:title" content="HTTP Connection 딮다이브 (2)">
		<meta property="og:description" content="my_study - HTTP Connection 딮다이브 (2)">
		<meta property="og:type" content="website">
		<meta property="og:url" content="opensource/urllib3/http-connection-딮다이브-(2).html">
		<meta property="og:image" content="undefined">
		<meta property="og:site_name" content="my_study">
		<link rel="alternate" type="application/rss+xml" title="RSS Feed" href="lib/rss.xml"><script async="" id="webpage-script" src="lib/scripts/webpage.js" onload="this.onload=null;this.setAttribute(&quot;loaded&quot;, &quot;true&quot;)"></script><script type="module" async="" id="graph-view-script" src="lib/scripts/graph-view.js"></script><script async="" id="graph-wasm-script" src="lib/scripts/graph-wasm.js" onload="this.onload=null;this.setAttribute(&quot;loaded&quot;, &quot;true&quot;)"></script><script async="" id="graph-render-worker-script" src="lib/scripts/graph-render-worker.js" onload="this.onload=null;this.setAttribute(&quot;loaded&quot;, &quot;true&quot;)"></script><script async="" id="tinycolor-script" src="lib/scripts/tinycolor.js" onload="this.onload=null;this.setAttribute(&quot;loaded&quot;, &quot;true&quot;)"></script><script async="" id="pixi-script" src="https://cdnjs.cloudflare.com/ajax/libs/pixi.js/7.4.0/pixi.min.js" onload="this.onload=null;this.setAttribute(&quot;loaded&quot;, &quot;true&quot;)"></script><script async="" id="minisearch-script" src="https://cdn.jsdelivr.net/npm/minisearch@6.3.0/dist/umd/index.min.js" onload="this.onload=null;this.setAttribute(&quot;loaded&quot;, &quot;true&quot;)"></script><link rel="icon" href="lib/media/favicon.png"><script async="" id="graph-data-script" src="lib/scripts/graph-data.js" onload="this.onload=null;this.setAttribute(&quot;loaded&quot;, &quot;true&quot;)"></script><style>body{--line-width:40em;--line-width-adaptive:40em;--file-line-width:40em;--sidebar-width:min(20em, 80vw);--collapse-arrow-size:11px;--tree-horizontal-spacing:0.6em;--tree-vertical-spacing:0.6em;--sidebar-margin:12px}.sidebar{height:100%;min-width:calc(var(--sidebar-width) + var(--divider-width-hover));max-width:calc(var(--sidebar-width) + var(--divider-width-hover));font-size:14px;z-index:10;position:relative;overflow:hidden;transition:min-width ease-in-out,max-width ease-in-out;transition-duration:.2s;contain:size}.sidebar-left{left:0}.sidebar-right{right:0}.sidebar.is-collapsed{min-width:0;max-width:0}body.floating-sidebars .sidebar{position:absolute}.sidebar-content{height:100%;min-width:calc(var(--sidebar-width) - var(--divider-width-hover));top:0;padding:var(--sidebar-margin);padding-top:4em;line-height:var(--line-height-tight);background-color:var(--background-secondary);transition:background-color,border-right,border-left,box-shadow;transition-duration:var(--color-fade-speed);transition-timing-function:ease-in-out;position:absolute;display:flex;flex-direction:column}.sidebar:not(.is-collapsed) .sidebar-content{min-width:calc(max(100%,var(--sidebar-width)) - 3px);max-width:calc(max(100%,var(--sidebar-width)) - 3px)}.sidebar-left .sidebar-content{left:0;border-top-right-radius:var(--radius-l);border-bottom-right-radius:var(--radius-l)}.sidebar-right .sidebar-content{right:0;border-top-left-radius:var(--radius-l);border-bottom-left-radius:var(--radius-l)}.sidebar:has(.sidebar-content:empty):has(.topbar-content:empty){display:none}.sidebar-topbar{height:2em;width:var(--sidebar-width);top:var(--sidebar-margin);padding-inline:var(--sidebar-margin);z-index:1;position:fixed;display:flex;align-items:center;transition:width ease-in-out;transition-duration:inherit}.sidebar.is-collapsed .sidebar-topbar{width:calc(2.3em + var(--sidebar-margin) * 2)}.sidebar .sidebar-topbar.is-collapsed{width:0}.sidebar-left .sidebar-topbar{left:0}.sidebar-right .sidebar-topbar{right:0}.topbar-content{overflow:hidden;overflow:clip;width:100%;height:100%;display:flex;align-items:center;transition:inherit}.sidebar.is-collapsed .topbar-content{width:0;transition:inherit}.clickable-icon.sidebar-collapse-icon{background-color:transparent;color:var(--icon-color-focused);padding:0!important;margin:0!important;height:100%!important;width:2.3em!important;margin-inline:0.14em!important;position:absolute}.sidebar-left .clickable-icon.sidebar-collapse-icon{transform:rotateY(180deg);right:var(--sidebar-margin)}.sidebar-right .clickable-icon.sidebar-collapse-icon{transform:rotateY(180deg);left:var(--sidebar-margin)}.clickable-icon.sidebar-collapse-icon svg.svg-icon{width:100%;height:100%}.sidebar-section-header{margin:0 0 1em 0;text-transform:uppercase;letter-spacing:.06em;font-weight:600}body{transition:background-color var(--color-fade-speed) ease-in-out}.webpage-container{display:flex;flex-direction:row;height:100%;width:100%;align-items:stretch;justify-content:center}.document-container{opacity:1;flex-basis:100%;max-width:100%;width:100%;height:100%;display:flex;flex-direction:column;align-items:center;transition:opacity .2s ease-in-out;contain:inline-size}.hide{opacity:0;transition:opacity .2s ease-in-out}.document-container>.markdown-preview-view{margin:var(--sidebar-margin);margin-bottom:0;width:100%;width:-webkit-fill-available;width:-moz-available;width:fill-available;background-color:var(--background-primary);transition:background-color var(--color-fade-speed) ease-in-out;border-top-right-radius:var(--window-radius,var(--radius-m));border-top-left-radius:var(--window-radius,var(--radius-m));overflow-x:hidden!important;overflow-y:auto!important;display:flex!important;flex-direction:column!important;align-items:center!important;contain:inline-size}.document-container>.markdown-preview-view>.markdown-preview-sizer{padding-bottom:80vh!important;width:100%!important;max-width:var(--line-width)!important;flex-basis:var(--line-width)!important;transition:background-color var(--color-fade-speed) ease-in-out;contain:inline-size}.markdown-rendered img:not([width]),.view-content img:not([width]){max-width:100%;outline:0}.document-container>.view-content.embed{display:flex;padding:1em;height:100%;width:100%;align-items:center;justify-content:center}.document-container>.view-content.embed>*{max-width:100%;max-height:100%;object-fit:contain}:has(> :is(.math,table)){overflow-x:auto!important}.document-container>.view-content{overflow-x:auto;contain:content;padding:0;margin:0;height:100%}.scroll-highlight{position:absolute;width:100%;height:100%;pointer-events:none;z-index:1000;background-color:hsla(var(--color-accent-hsl),.25);opacity:0;padding:1em;inset:50%;translate:-50% -50%;border-radius:var(--radius-s)}</style><script defer="">async function loadIncludes(){if("file:"!=location.protocol){let e=document.querySelectorAll("include");for(let t=0;t<e.length;t++){let o=e[t],l=o.getAttribute("src");try{const e=await fetch(l);if(!e.ok){console.log("Could not include file: "+l),o?.remove();continue}let t=await e.text(),n=document.createRange().createContextualFragment(t),i=Array.from(n.children);for(let e of i)e.classList.add("hide"),e.style.transition="opacity 0.5s ease-in-out",setTimeout((()=>{e.classList.remove("hide")}),10);o.before(n),o.remove(),console.log("Included file: "+l)}catch(e){o?.remove(),console.log("Could not include file: "+l,e);continue}}}else{if(document.querySelectorAll("include").length>0){var e=document.createElement("div");e.id="error",e.textContent="Web server exports must be hosted on an http / web server to be viewed correctly.",e.style.position="fixed",e.style.top="50%",e.style.left="50%",e.style.transform="translate(-50%, -50%)",e.style.fontSize="1.5em",e.style.fontWeight="bold",e.style.textAlign="center",document.body.appendChild(e),document.querySelector(".document-container")?.classList.remove("hide")}}}document.addEventListener("DOMContentLoaded",(()=>{loadIncludes()}));let isFileProtocol="file:"==location.protocol;function waitLoadScripts(e,t){let o=e.map((e=>document.getElementById(e+"-script"))),l=0;!function e(){let n=o[l];l++,n&&"true"!=n.getAttribute("loaded")||l<o.length&&e(),l<o.length?n.addEventListener("load",e):t()}()}</script><link rel="stylesheet" href="lib/styles/obsidian.css"><link rel="preload" href="lib/styles/other-plugins.css" as="style" onload="this.onload=null;this.rel='stylesheet'"><noscript><link rel="stylesheet" href="lib/styles/other-plugins.css"></noscript><link rel="stylesheet" href="lib/styles/theme.css"><link rel="preload" href="lib/styles/global-variable-styles.css" as="style" onload="this.onload=null;this.rel='stylesheet'"><noscript><link rel="stylesheet" href="lib/styles/global-variable-styles.css"></noscript><link rel="preload" href="lib/styles/supported-plugins.css" as="style" onload="this.onload=null;this.rel='stylesheet'"><noscript><link rel="stylesheet" href="lib/styles/supported-plugins.css"></noscript><link rel="preload" href="lib/styles/main-styles.css" as="style" onload="this.onload=null;this.rel='stylesheet'"><noscript><link rel="stylesheet" href="lib/styles/main-styles.css"></noscript><link rel="preload" href="lib/styles/snippets.css" as="style" onload="this.onload=null;this.rel='stylesheet'"><noscript><link rel="stylesheet" href="lib/styles/snippets.css"></noscript></head><body class="publish css-settings-manager theme-light show-inline-title show-ribbon code-styler code-styler-style-inline code-styler-gutter-highlight"><script defer="">let theme=localStorage.getItem("theme")||(window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light");"dark"==theme?(document.body.classList.add("theme-dark"),document.body.classList.remove("theme-light")):(document.body.classList.add("theme-light"),document.body.classList.remove("theme-dark")),window.innerWidth<480?document.body.classList.add("is-phone"):window.innerWidth<768?document.body.classList.add("is-tablet"):window.innerWidth<1024?document.body.classList.add("is-small-screen"):document.body.classList.add("is-large-screen")</script><div class="webpage-container workspace"><div class="sidebar-left sidebar"><div class="sidebar-handle"></div><div class="sidebar-topbar"><div class="topbar-content"></div><div class="clickable-icon sidebar-collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="100%" height="100%" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" class="svg-icon"><path d="M21 3H3C1.89543 3 1 3.89543 1 5V19C1 20.1046 1.89543 21 3 21H21C22.1046 21 23 20.1046 23 19V5C23 3.89543 22.1046 3 21 3Z"></path><path d="M10 4V20"></path><path d="M4 7H7"></path><path d="M4 10H7"></path><path d="M4 13H7"></path></svg></div></div><div class="sidebar-content"><div class="search-input-container"><input enterkeyhint="search" type="search" spellcheck="false" placeholder="Search..."><div class="search-input-clear-button" aria-label="Clear search"></div></div><include src="lib/html/file-tree.html"></include></div><script defer="">let ls = document.querySelector(".sidebar-left"); ls.classList.add("is-collapsed"); if (window.innerWidth > 768) ls.classList.remove("is-collapsed"); ls.style.setProperty("--sidebar-width", localStorage.getItem("sidebar-left-width"));</script></div><div class="document-container markdown-reading-view hide"><div class="markdown-preview-view markdown-rendered allow-fold-headings allow-fold-lists is-readable-line-width"><style id="MJX-CHTML-styles">mjx-mfrac{display:inline-block;text-align:left}mjx-frac{display:inline-block;vertical-align:.17em;padding:0 .22em}mjx-frac[type="d"]{vertical-align:.04em}mjx-frac[delims]{padding:0 .1em}mjx-frac[atop]{padding:0 .12em}mjx-frac[atop][delims]{padding:0}mjx-dtable{display:inline-table;width:100%}mjx-dtable>*{font-size:2000%}mjx-dbox{display:block;font-size:5%}mjx-num{display:block;text-align:center}mjx-den{display:block;text-align:center}mjx-mfrac[bevelled]>mjx-num{display:inline-block}mjx-mfrac[bevelled]>mjx-den{display:inline-block}mjx-den[align=right],mjx-num[align=right]{text-align:right}mjx-den[align=left],mjx-num[align=left]{text-align:left}mjx-nstrut{display:inline-block;height:.054em;width:0;vertical-align:-.054em}mjx-nstrut[type="d"]{height:.217em;vertical-align:-.217em}mjx-dstrut{display:inline-block;height:.505em;width:0}mjx-dstrut[type="d"]{height:.726em}mjx-line{display:block;box-sizing:border-box;min-height:1px;height:.06em;border-top:.06em solid;margin:.06em -.1em;overflow:hidden}mjx-line[type="d"]{margin:.18em -.1em}mjx-mrow{display:inline-block;text-align:left}mjx-mspace{display:inline-block;text-align:left}mjx-c.mjx-c30::before{padding:.666em .5em .022em 0;content:"0"}mjx-c.mjx-c32::before{padding:.666em .5em 0 0;content:"2"}mjx-c.mjx-c34::before{padding:.677em .5em 0 0;content:"4"}mjx-c.mjx-c37::before{padding:.676em .5em .022em 0;content:"7"}mjx-c.mjx-c33::before{padding:.665em .5em .022em 0;content:"3"}mjx-c.mjx-c36::before{padding:.666em .5em .022em 0;content:"6"}mjx-c.mjx-c1D463.TEX-I::before{padding:.443em .485em .011em 0;content:"v"}mjx-c.mjx-c1D45F.TEX-I::before{padding:.442em .451em .011em 0;content:"r"}mjx-c.mjx-c1D44E.TEX-I::before{padding:.441em .529em .01em 0;content:"a"}mjx-c.mjx-c1D454.TEX-I::before{padding:.442em .477em .205em 0;content:"g"}mjx-c.mjx-c1D460.TEX-I::before{padding:.442em .469em .01em 0;content:"s"}mjx-c.mjx-c1D45C.TEX-I::before{padding:.441em .485em .011em 0;content:"o"}mjx-c.mjx-c1D45B.TEX-I::before{padding:.442em .6em .011em 0;content:"n"}mjx-c.mjx-c1D447.TEX-I::before{padding:.677em .704em 0 0;content:"T"}mjx-c.mjx-c35::before{padding:.666em .5em .022em 0;content:"5"}mjx-c.mjx-c2E::before{padding:.12em .278em 0 0;content:"."}mjx-msub{display:inline-block;text-align:left}mjx-c.mjx-c1D436.TEX-I::before{padding:.705em .76em .022em 0;content:"C"}mjx-c.mjx-c1D434.TEX-I::before{padding:.716em .75em 0 0;content:"A"}mjx-c.mjx-c1D449.TEX-I::before{padding:.683em .769em .022em 0;content:"V"}mjx-c.mjx-c1D445.TEX-I::before{padding:.683em .759em .021em 0;content:"R"}mjx-c.mjx-c1D443.TEX-I::before{padding:.683em .751em 0 0;content:"P"}mjx-c.mjx-c1D456.TEX-I::before{padding:.661em .345em .011em 0;content:"i"}mjx-container[jax=CHTML]{line-height:0}mjx-container [space="1"]{margin-left:.111em}mjx-container [space="2"]{margin-left:.167em}mjx-container [space="3"]{margin-left:.222em}mjx-container [space="4"]{margin-left:.278em}mjx-container [space="5"]{margin-left:.333em}mjx-container [rspace="1"]{margin-right:.111em}mjx-container [rspace="2"]{margin-right:.167em}mjx-container [rspace="3"]{margin-right:.222em}mjx-container [rspace="4"]{margin-right:.278em}mjx-container [rspace="5"]{margin-right:.333em}mjx-container [size="s"]{font-size:70.7%}mjx-container [size=ss]{font-size:50%}mjx-container [size=Tn]{font-size:60%}mjx-container [size=sm]{font-size:85%}mjx-container [size=lg]{font-size:120%}mjx-container [size=Lg]{font-size:144%}mjx-container [size=LG]{font-size:173%}mjx-container [size=hg]{font-size:207%}mjx-container [size=HG]{font-size:249%}mjx-container [width=full]{width:100%}mjx-box{display:inline-block}mjx-block{display:block}mjx-itable{display:inline-table}mjx-row{display:table-row}mjx-row>*{display:table-cell}mjx-mtext{display:inline-block;text-align:left}mjx-mstyle{display:inline-block}mjx-merror{display:inline-block;color:red;background-color:#ff0}mjx-mphantom{visibility:hidden}mjx-assistive-mml{top:0;left:0;clip:rect(1px,1px,1px,1px);user-select:none;position:absolute!important;padding:1px 0 0!important;border:0!important;display:block!important;width:auto!important;overflow:hidden!important}mjx-assistive-mml[display=block]{width:100%!important}mjx-math{display:inline-block;text-align:left;line-height:0;text-indent:0;font-style:normal;font-weight:400;font-size:100%;letter-spacing:normal;border-collapse:collapse;overflow-wrap:normal;word-spacing:normal;white-space:nowrap;direction:ltr;padding:1px 0}mjx-container[jax=CHTML][display=true]{display:block;text-align:center;margin:1em 0}mjx-container[jax=CHTML][display=true][width=full]{display:flex}mjx-container[jax=CHTML][display=true] mjx-math{padding:0}mjx-container[jax=CHTML][justify=left]{text-align:left}mjx-container[jax=CHTML][justify=right]{text-align:right}mjx-c{display:inline-block}mjx-utext{display:inline-block;padding:.75em 0 .2em}mjx-mo{display:inline-block;text-align:left}mjx-stretchy-h{display:inline-table;width:100%}mjx-stretchy-h>*{display:table-cell;width:0}mjx-stretchy-h>*>mjx-c{display:inline-block;transform:scaleX(1)}mjx-stretchy-h>*>mjx-c::before{display:inline-block;width:initial}mjx-stretchy-h>mjx-ext{overflow:clip visible;width:100%}mjx-stretchy-h>mjx-ext>mjx-c::before{transform:scaleX(500)}mjx-stretchy-h>mjx-ext>mjx-c{width:0}mjx-stretchy-h>mjx-beg>mjx-c{margin-right:-.1em}mjx-stretchy-h>mjx-end>mjx-c{margin-left:-.1em}mjx-stretchy-v{display:inline-block}mjx-stretchy-v>*{display:block}mjx-stretchy-v>mjx-beg{height:0}mjx-stretchy-v>mjx-end>mjx-c{display:block}mjx-stretchy-v>*>mjx-c{transform:scaleY(1);transform-origin:left center;overflow:hidden}mjx-stretchy-v>mjx-ext{display:block;height:100%;box-sizing:border-box;border:0 solid transparent;overflow:visible clip}mjx-stretchy-v>mjx-ext>mjx-c::before{width:initial;box-sizing:border-box}mjx-stretchy-v>mjx-ext>mjx-c{transform:scaleY(500) translateY(.075em);overflow:visible}mjx-mark{display:inline-block;height:0}mjx-mi{display:inline-block;text-align:left}mjx-mn{display:inline-block;text-align:left}mjx-msup{display:inline-block;text-align:left}mjx-texatom{display:inline-block;text-align:left}mjx-c::before{display:block;width:0}.MJX-TEX{font-family:MJXZERO,MJXTEX}.TEX-B{font-family:MJXZERO,MJXTEX-B}.TEX-I{font-family:MJXZERO,MJXTEX-I}.TEX-MI{font-family:MJXZERO,MJXTEX-MI}.TEX-BI{font-family:MJXZERO,MJXTEX-BI}.TEX-S1{font-family:MJXZERO,MJXTEX-S1}.TEX-S2{font-family:MJXZERO,MJXTEX-S2}.TEX-S3{font-family:MJXZERO,MJXTEX-S3}.TEX-S4{font-family:MJXZERO,MJXTEX-S4}.TEX-A{font-family:MJXZERO,MJXTEX-A}.TEX-C{font-family:MJXZERO,MJXTEX-C}.TEX-CB{font-family:MJXZERO,MJXTEX-CB}.TEX-FR{font-family:MJXZERO,MJXTEX-FR}.TEX-FRB{font-family:MJXZERO,MJXTEX-FRB}.TEX-SS{font-family:MJXZERO,MJXTEX-SS}.TEX-SSB{font-family:MJXZERO,MJXTEX-SSB}.TEX-SSI{font-family:MJXZERO,MJXTEX-SSI}.TEX-SC{font-family:MJXZERO,MJXTEX-SC}.TEX-T{font-family:MJXZERO,MJXTEX-T}.TEX-V{font-family:MJXZERO,MJXTEX-V}.TEX-VB{font-family:MJXZERO,MJXTEX-VB}mjx-stretchy-h mjx-c,mjx-stretchy-v mjx-c{font-family:MJXZERO,MJXTEX-S1,MJXTEX-S4,MJXTEX,MJXTEX-A!important}@font-face{font-family:MJXZERO;src:url("lib/fonts/mathjax_zero.woff") format("woff")}@font-face{font-family:MJXTEX;src:url("lib/fonts/mathjax_main-regular.woff") format("woff")}@font-face{font-family:MJXTEX-B;src:url("lib/fonts/mathjax_main-bold.woff") format("woff")}@font-face{font-family:MJXTEX-I;src:url("lib/fonts/mathjax_math-italic.woff") format("woff")}@font-face{font-family:MJXTEX-MI;src:url("lib/fonts/mathjax_main-italic.woff") format("woff")}@font-face{font-family:MJXTEX-BI;src:url("lib/fonts/mathjax_math-bolditalic.woff") format("woff")}@font-face{font-family:MJXTEX-S1;src:url("lib/fonts/mathjax_size1-regular.woff") format("woff")}@font-face{font-family:MJXTEX-S2;src:url("lib/fonts/mathjax_size2-regular.woff") format("woff")}@font-face{font-family:MJXTEX-S3;src:url("lib/fonts/mathjax_size3-regular.woff") format("woff")}@font-face{font-family:MJXTEX-S4;src:url("lib/fonts/mathjax_size4-regular.woff") format("woff")}@font-face{font-family:MJXTEX-A;src:url("lib/fonts/mathjax_ams-regular.woff") format("woff")}@font-face{font-family:MJXTEX-C;src:url("lib/fonts/mathjax_calligraphic-regular.woff") format("woff")}@font-face{font-family:MJXTEX-CB;src:url("lib/fonts/mathjax_calligraphic-bold.woff") format("woff")}@font-face{font-family:MJXTEX-FR;src:url("lib/fonts/mathjax_fraktur-regular.woff") format("woff")}@font-face{font-family:MJXTEX-FRB;src:url("lib/fonts/mathjax_fraktur-bold.woff") format("woff")}@font-face{font-family:MJXTEX-SS;src:url("lib/fonts/mathjax_sansserif-regular.woff") format("woff")}@font-face{font-family:MJXTEX-SSB;src:url("lib/fonts/mathjax_sansserif-bold.woff") format("woff")}@font-face{font-family:MJXTEX-SSI;src:url("lib/fonts/mathjax_sansserif-italic.woff") format("woff")}@font-face{font-family:MJXTEX-SC;src:url("lib/fonts/mathjax_script-regular.woff") format("woff")}@font-face{font-family:MJXTEX-T;src:url("lib/fonts/mathjax_typewriter-regular.woff") format("woff")}@font-face{font-family:MJXTEX-V;src:url("lib/fonts/mathjax_vector-regular.woff") format("woff")}@font-face{font-family:MJXTEX-VB;src:url("lib/fonts/mathjax_vector-bold.woff") format("woff")}mjx-c.mjx-c28::before{padding:.75em .389em .25em 0;content:"("}mjx-c.mjx-c1D45D.TEX-I::before{padding:.442em .503em .194em 0;content:"p"}mjx-c.mjx-c2212::before{padding:.583em .778em .082em 0;content:"−"}mjx-c.mjx-c31::before{padding:.666em .5em 0 0;content:"1"}mjx-c.mjx-c29::before{padding:.75em .389em .25em 0;content:")"}mjx-c.mjx-c2C::before{padding:.121em .278em .194em 0;content:","}mjx-c.mjx-c1D45E.TEX-I::before{padding:.442em .46em .194em 0;content:"q"}mjx-c.mjx-c1D452.TEX-I::before{padding:.442em .466em .011em 0;content:"e"}mjx-c.mjx-c1D451.TEX-I::before{padding:.694em .52em .01em 0;content:"d"}mjx-c.mjx-c1D441.TEX-I::before{padding:.683em .888em 0 0;content:"N"}mjx-c.mjx-c3D::before{padding:.583em .778em .082em 0;content:"="}mjx-c.mjx-c1D45A.TEX-I::before{padding:.442em .878em .011em 0;content:"m"}mjx-c.mjx-c1D450.TEX-I::before{padding:.442em .433em .011em 0;content:"c"}mjx-c.mjx-c6D::before{padding:.442em .833em 0 0;content:"m"}mjx-c.mjx-c6F::before{padding:.448em .5em .01em 0;content:"o"}mjx-c.mjx-c64::before{padding:.694em .556em .011em 0;content:"d"}mjx-c.mjx-c1D458.TEX-I::before{padding:.694em .521em .011em 0;content:"k"}mjx-c.mjx-c2B::before{padding:.583em .778em .082em 0;content:"+"}</style><div class="markdown-preview-sizer markdown-preview-section"><h1 class="page-title heading inline-title" id="HTTP Connection 딮다이브 (2)"><p dir="auto">HTTP Connection 딮다이브 (2)</p></h1><div class="heading-wrapper"><h3 data-heading="HTTPConnection" dir="auto" class="heading" id="HTTPConnection"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>HTTPConnection</h3><div class="heading-children"><div><p dir="auto"><a data-tooltip-position="top" aria-label="HTTPConnection 부터 send까지 (1) > HTTPConnection" data-href="HTTPConnection 부터 send까지 (1)#HTTPConnection" href="opensource/urllib3/httpconnection-부터-send까지-(1).html#HTTPConnection" class="internal-link" target="_self" rel="noopener">HTTPConnection</a> 에서 우선적으로 다뤘지만, 자세히는 다루지 못해 이하에서 깊게 다루는 작업을 진행해보고자 한다. 앞서 정리했던 내용을 상기해보면, 해당 클래스는 파이썬 내장 라이브러리인 <code class="code-styler-inline">http.client.HTTPConnection</code> 을 상속헤 구현되고 있다.  실질적인 HTTP 통신에서 활용되는 연결을 생성하고 메시지를 전송, 수신하며 인코딩, 디코딩 등의 작업도 수행한다.</p></div><div><p dir="auto">이제 자세하게 커넥션 클래스를 분석해보자. 우리가 분석해야할 요소는 다음과 같다.</p></div><div><ul dir="auto">
<li data-line="0" dir="auto">연결을 어떻게 생성하는가?</li>
<li data-line="1" dir="auto">메시지를 어떻게 전송하는가?</li>
<li data-line="2" dir="auto">메시지를 어떻게 수신하는가?</li>
<li data-line="3" dir="auto">연결을 어떻게 종료하는가?</li>
</ul></div><div><hr dir="auto"></div></div></div><div class="heading-wrapper"><h3 data-heading="연결을 어떻게 생성하는가?" dir="auto" class="heading" id="연결을_어떻게_생성하는가?"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>연결을 어떻게 생성하는가?</h3><div class="heading-children"><div><p dir="auto">연결을 생성하는 코드는 아래에 대부분 정의 돼있다.</p></div><div><pre dir="auto" class="language-python" tabindex="0"><code class="language-python is-loaded">    <span class="token decorator annotation punctuation">@property</span>
    <span class="token keyword">def</span> <span class="token function">host</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">str</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""
        Getter method to remove any trailing dots that indicate the hostname is an FQDN.
            
            google.com.
            
            gooogle.com

        In general, SSL certificates don't include the trailing dot indicating a
        fully-qualified domain name, and thus, they don't validate properly when
        checked against a domain name that includes the dot. In addition, some
        servers may not expect to receive the trailing dot when provided.

        However, the hostname with trailing dot is critical to DNS resolution; doing a
        lookup with the trailing dot will properly only resolve the appropriate FQDN,
        whereas a lookup without a trailing dot will search the system's search domain
        list. Thus, it's important to keep the original host around for use only in
        those cases where it's appropriate (i.e., when doing DNS lookup to establish the
        actual TCP connection across which we're going to send HTTP requests).
        """</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>_dns_host<span class="token punctuation">.</span>rstrip<span class="token punctuation">(</span><span class="token string">"."</span><span class="token punctuation">)</span>
 
    <span class="token decorator annotation punctuation">@host<span class="token punctuation">.</span>setter</span>
    <span class="token keyword">def</span> <span class="token function">host</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> value<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""
        Setter for the `host` property.

        We assume that only urllib3 uses the _dns_host attribute; httplib itself
        only uses `host`, and it seems reasonable that other libraries follow suit.
        """</span>
        self<span class="token punctuation">.</span>_dns_host <span class="token operator">=</span> value

    <span class="token keyword">def</span> <span class="token function">_new_conn</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> socket<span class="token punctuation">.</span>socket<span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""Establish a socket connection and set nodelay settings on it.

        :return: New socket connection.
        """</span>
        <span class="token keyword">try</span><span class="token punctuation">:</span>
            sock <span class="token operator">=</span> connection<span class="token punctuation">.</span>create_connection<span class="token punctuation">(</span>
                <span class="token punctuation">(</span>self<span class="token punctuation">.</span>_dns_host<span class="token punctuation">,</span> self<span class="token punctuation">.</span>port<span class="token punctuation">)</span><span class="token punctuation">,</span>
                self<span class="token punctuation">.</span>timeout<span class="token punctuation">,</span>
                source_address<span class="token operator">=</span>self<span class="token punctuation">.</span>source_address<span class="token punctuation">,</span>
                socket_options<span class="token operator">=</span>self<span class="token punctuation">.</span>socket_options<span class="token punctuation">,</span>
            <span class="token punctuation">)</span>
        <span class="token keyword">except</span> socket<span class="token punctuation">.</span>gaierror <span class="token keyword">as</span> e<span class="token punctuation">:</span>
            <span class="token keyword">raise</span> NameResolutionError<span class="token punctuation">(</span>self<span class="token punctuation">.</span>host<span class="token punctuation">,</span> self<span class="token punctuation">,</span> e<span class="token punctuation">)</span> <span class="token keyword">from</span> e
        <span class="token keyword">except</span> SocketTimeout <span class="token keyword">as</span> e<span class="token punctuation">:</span>
            <span class="token keyword">raise</span> ConnectTimeoutError<span class="token punctuation">(</span>
                self<span class="token punctuation">,</span>
                <span class="token string-interpolation"><span class="token string">f"Connection to </span><span class="token interpolation"><span class="token punctuation">{</span>self<span class="token punctuation">.</span>host<span class="token punctuation">}</span></span><span class="token string"> timed out. (connect timeout=</span><span class="token interpolation"><span class="token punctuation">{</span>self<span class="token punctuation">.</span>timeout<span class="token punctuation">}</span></span><span class="token string">)"</span></span><span class="token punctuation">,</span>
            <span class="token punctuation">)</span> <span class="token keyword">from</span> e

        <span class="token keyword">except</span> OSError <span class="token keyword">as</span> e<span class="token punctuation">:</span>
            <span class="token keyword">raise</span> NewConnectionError<span class="token punctuation">(</span>
                self<span class="token punctuation">,</span> <span class="token string-interpolation"><span class="token string">f"Failed to establish a new connection: </span><span class="token interpolation"><span class="token punctuation">{</span>e<span class="token punctuation">}</span></span><span class="token string">"</span></span>
            <span class="token punctuation">)</span> <span class="token keyword">from</span> e

        <span class="token comment"># Audit hooks are only available in Python 3.8+</span>
        <span class="token keyword">if</span> _HAS_SYS_AUDIT<span class="token punctuation">:</span>
            sys<span class="token punctuation">.</span>audit<span class="token punctuation">(</span><span class="token string">"http.client.connect"</span><span class="token punctuation">,</span> self<span class="token punctuation">,</span> self<span class="token punctuation">.</span>host<span class="token punctuation">,</span> self<span class="token punctuation">.</span>port<span class="token punctuation">)</span>

        <span class="token keyword">return</span> sock
</code><button class="copy-code-button">Copy</button></pre></div><div><p dir="auto">우선적으로 눈여겨봐야할 부분은 host인데 사실 커넥션 클래스 자체는 host 속성을 갖고 있지 않다. 실질적인 host 속성은 부모 클래스에 지정 돼있다. 또한 host 속성을 프로퍼티로 정의해 setter에서 host를 수정할 경우 <code class="code-styler-inline">_dns_host</code> 의 값을 변경하게 된다. 따라서 초창기 커넥션 객체를 생성하기 위해 host를 전달하면 <code class="code-styler-inline">__init__</code> 메서드가 실행되며 부모 클래스를 생성하는데, 이때 프로퍼티의 setter가 오버라이딩 돼 host 속성이 아닌 <code class="code-styler-inline">_dns_host</code> 가 초기화 된다.</p></div><div><p dir="auto">정리하자면 host 속성을 부모 클래스를 생성하며 초기화 하는데 이때 오버라이딩된 setter가 동작해 실질적으로는 <code class="code-styler-inline">_dns_host</code>의 속성 값이 초기화 된다.</p></div><div><p dir="auto">이렇게 번잡한 작업을 수행한 이유는 전부 <a data-href="FQDN" href="network/fqdn.html" class="internal-link" target="_self" rel="noopener">FQDN</a> 때문이다. 종종 FQDN의 호스트와 일반적인 URL의 호스팅을 다르게 하는 서비스들이 존재해 이에 대응하고자 이런 식으로 호스트 속성을 관리한다. (exmaple.com과 example.com.이 다른 ip를 갖는 경우가 있다고 한다...) <a data-tooltip-position="top" aria-label="https://github.com/urllib3/urllib3/pull/1255" rel="noopener" class="external-link" href="https://github.com/urllib3/urllib3/pull/1255" target="_blank">참고</a></p></div><div><hr dir="auto"></div></div></div><div class="heading-wrapper"><h3 data-heading="HTTP Connection의 메시지 전송" dir="auto" class="heading" id="HTTP_Connection의_메시지_전송"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>HTTP Connection의 메시지 전송</h3><div class="heading-children"><div><p dir="auto">연결을 생성한 후 메시지의 전송은 모두 <code class="code-styler-inline">request</code> 함수에서 진행된다. 아래는 함수의 구현부이다.</p></div><div><pre dir="auto" class="language-python" tabindex="0"><code class="language-python is-loaded">	<span class="token comment"># `request` method's signature intentionally violates LSP.</span>
    <span class="token comment"># urllib3's API is different from `http.client.HTTPConnection` and the subclassing is only incidental.</span>
    <span class="token keyword">def</span> <span class="token function">request</span><span class="token punctuation">(</span>  <span class="token comment"># type: ignore[override]</span>
        self<span class="token punctuation">,</span>
        method<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">,</span>
        url<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">,</span>
        body<span class="token punctuation">:</span> _TYPE_BODY <span class="token operator">|</span> <span class="token boolean">None</span> <span class="token operator">=</span> <span class="token boolean">None</span><span class="token punctuation">,</span>
        headers<span class="token punctuation">:</span> typing<span class="token punctuation">.</span>Mapping<span class="token punctuation">[</span><span class="token builtin">str</span><span class="token punctuation">,</span> <span class="token builtin">str</span><span class="token punctuation">]</span> <span class="token operator">|</span> <span class="token boolean">None</span> <span class="token operator">=</span> <span class="token boolean">None</span><span class="token punctuation">,</span>
        <span class="token operator">*</span><span class="token punctuation">,</span>
        chunked<span class="token punctuation">:</span> <span class="token builtin">bool</span> <span class="token operator">=</span> <span class="token boolean">False</span><span class="token punctuation">,</span>
        preload_content<span class="token punctuation">:</span> <span class="token builtin">bool</span> <span class="token operator">=</span> <span class="token boolean">True</span><span class="token punctuation">,</span>
        decode_content<span class="token punctuation">:</span> <span class="token builtin">bool</span> <span class="token operator">=</span> <span class="token boolean">True</span><span class="token punctuation">,</span>
        enforce_content_length<span class="token punctuation">:</span> <span class="token builtin">bool</span> <span class="token operator">=</span> <span class="token boolean">True</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
        <span class="token comment"># Update the inner socket's timeout value to send the request.</span>
        <span class="token comment"># This only triggers if the connection is re-used.</span>
        <span class="token keyword">if</span> self<span class="token punctuation">.</span>sock <span class="token keyword">is</span> <span class="token keyword">not</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>sock<span class="token punctuation">.</span>settimeout<span class="token punctuation">(</span>self<span class="token punctuation">.</span>timeout<span class="token punctuation">)</span>

        <span class="token comment"># Store these values to be fed into the HTTPResponse</span>
        <span class="token comment"># object later. TODO: Remove this in favor of a real</span>
        <span class="token comment"># HTTP lifecycle mechanism.</span>

        <span class="token comment"># We have to store these before we call .request()</span>
        <span class="token comment"># because sometimes we can still salvage a response</span>
        <span class="token comment"># off the wire even if we aren't able to completely</span>
        <span class="token comment"># send the request body.</span>
        self<span class="token punctuation">.</span>_response_options <span class="token operator">=</span> _ResponseOptions<span class="token punctuation">(</span>
            request_method<span class="token operator">=</span>method<span class="token punctuation">,</span>
            request_url<span class="token operator">=</span>url<span class="token punctuation">,</span>
            preload_content<span class="token operator">=</span>preload_content<span class="token punctuation">,</span>
            decode_content<span class="token operator">=</span>decode_content<span class="token punctuation">,</span>
            enforce_content_length<span class="token operator">=</span>enforce_content_length<span class="token punctuation">,</span>
        <span class="token punctuation">)</span>

        <span class="token keyword">if</span> headers <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
            headers <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
        header_keys <span class="token operator">=</span> <span class="token builtin">frozenset</span><span class="token punctuation">(</span>to_str<span class="token punctuation">(</span>k<span class="token punctuation">.</span>lower<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">for</span> k <span class="token keyword">in</span> headers<span class="token punctuation">)</span>
        skip_accept_encoding <span class="token operator">=</span> <span class="token string">"accept-encoding"</span> <span class="token keyword">in</span> header_keys
        skip_host <span class="token operator">=</span> <span class="token string">"host"</span> <span class="token keyword">in</span> header_keys
        self<span class="token punctuation">.</span>putrequest<span class="token punctuation">(</span>
            method<span class="token punctuation">,</span> url<span class="token punctuation">,</span> skip_accept_encoding<span class="token operator">=</span>skip_accept_encoding<span class="token punctuation">,</span> skip_host<span class="token operator">=</span>skip_host
        <span class="token punctuation">)</span>

        <span class="token comment"># Transform the body into an iterable of sendall()-able chunks</span>
        <span class="token comment"># and detect if an explicit Content-Length is doable.</span>
        chunks_and_cl <span class="token operator">=</span> body_to_chunks<span class="token punctuation">(</span>body<span class="token punctuation">,</span> method<span class="token operator">=</span>method<span class="token punctuation">,</span> blocksize<span class="token operator">=</span>self<span class="token punctuation">.</span>blocksize<span class="token punctuation">)</span>
        chunks <span class="token operator">=</span> chunks_and_cl<span class="token punctuation">.</span>chunks
        content_length <span class="token operator">=</span> chunks_and_cl<span class="token punctuation">.</span>content_length

        <span class="token comment"># When chunked is explicit set to 'True' we respect that.</span>
        <span class="token keyword">if</span> chunked<span class="token punctuation">:</span>
            <span class="token keyword">if</span> <span class="token string">"transfer-encoding"</span> <span class="token keyword">not</span> <span class="token keyword">in</span> header_keys<span class="token punctuation">:</span>
                self<span class="token punctuation">.</span>putheader<span class="token punctuation">(</span><span class="token string">"Transfer-Encoding"</span><span class="token punctuation">,</span> <span class="token string">"chunked"</span><span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            <span class="token comment"># Detect whether a framing mechanism is already in use. If so</span>
            <span class="token comment"># we respect that value, otherwise we pick chunked vs content-length</span>
            <span class="token comment"># depending on the type of 'body'.</span>
            <span class="token keyword">if</span> <span class="token string">"content-length"</span> <span class="token keyword">in</span> header_keys<span class="token punctuation">:</span>
                chunked <span class="token operator">=</span> <span class="token boolean">False</span>
            <span class="token keyword">elif</span> <span class="token string">"transfer-encoding"</span> <span class="token keyword">in</span> header_keys<span class="token punctuation">:</span>
                chunked <span class="token operator">=</span> <span class="token boolean">True</span>

            <span class="token comment"># Otherwise we go off the recommendation of 'body_to_chunks()'.</span>
            <span class="token keyword">else</span><span class="token punctuation">:</span>
                chunked <span class="token operator">=</span> <span class="token boolean">False</span>
                <span class="token keyword">if</span> content_length <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
                    <span class="token keyword">if</span> chunks <span class="token keyword">is</span> <span class="token keyword">not</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
                        chunked <span class="token operator">=</span> <span class="token boolean">True</span>
                        self<span class="token punctuation">.</span>putheader<span class="token punctuation">(</span><span class="token string">"Transfer-Encoding"</span><span class="token punctuation">,</span> <span class="token string">"chunked"</span><span class="token punctuation">)</span>
                <span class="token keyword">else</span><span class="token punctuation">:</span>
                    self<span class="token punctuation">.</span>putheader<span class="token punctuation">(</span><span class="token string">"Content-Length"</span><span class="token punctuation">,</span> <span class="token builtin">str</span><span class="token punctuation">(</span>content_length<span class="token punctuation">)</span><span class="token punctuation">)</span>

        <span class="token comment"># Now that framing headers are out of the way we send all the other headers.</span>
        <span class="token keyword">if</span> <span class="token string">"user-agent"</span> <span class="token keyword">not</span> <span class="token keyword">in</span> header_keys<span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>putheader<span class="token punctuation">(</span><span class="token string">"User-Agent"</span><span class="token punctuation">,</span> _get_default_user_agent<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">for</span> header<span class="token punctuation">,</span> value <span class="token keyword">in</span> headers<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>putheader<span class="token punctuation">(</span>header<span class="token punctuation">,</span> value<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>endheaders<span class="token punctuation">(</span><span class="token punctuation">)</span>

        <span class="token comment"># If we're given a body we start sending that in chunks.</span>
        <span class="token keyword">if</span> chunks <span class="token keyword">is</span> <span class="token keyword">not</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
            <span class="token keyword">for</span> chunk <span class="token keyword">in</span> chunks<span class="token punctuation">:</span>
                <span class="token comment"># Sending empty chunks isn't allowed for TE: chunked</span>
                <span class="token comment"># as it indicates the end of the body.</span>
                <span class="token keyword">if</span> <span class="token keyword">not</span> chunk<span class="token punctuation">:</span>
                    <span class="token keyword">continue</span>
                <span class="token keyword">if</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>chunk<span class="token punctuation">,</span> <span class="token builtin">str</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                    chunk <span class="token operator">=</span> chunk<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">"utf-8"</span><span class="token punctuation">)</span>
                <span class="token keyword">if</span> chunked<span class="token punctuation">:</span>
                    self<span class="token punctuation">.</span>send<span class="token punctuation">(</span><span class="token string">b"%x\r\n%b\r\n"</span> <span class="token operator">%</span> <span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>chunk<span class="token punctuation">)</span><span class="token punctuation">,</span> chunk<span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token keyword">else</span><span class="token punctuation">:</span>
                    self<span class="token punctuation">.</span>send<span class="token punctuation">(</span>chunk<span class="token punctuation">)</span>

        <span class="token comment"># Regardless of whether we have a body or not, if we're in</span>
        <span class="token comment"># chunked mode we want to send an explicit empty chunk.</span>
        <span class="token keyword">if</span> chunked<span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>send<span class="token punctuation">(</span><span class="token string">b"0\r\n\r\n"</span><span class="token punctuation">)</span>
</code><button class="copy-code-button">Copy</button></pre></div><div><p dir="auto">함수는 LSP를 지키지 않는다는 충격적인 내용으로 시작하는데 이는 곧 부모 메서드의 기능을 자식 메서드에서 보장하지 않음을 의미한다. 이는 파이썬 내장 라이브러리인 <code class="code-styler-inline">http.client</code> 를 상속 받았지만, 별개의 기능을 하기 위함 이라는데 솔직히 잘 모르겠다. (이럴거면 다른 명칭을 붙이는게 맞지 않나?)</p></div><div><p dir="auto">함수가 수행하는 작업은 다음과 같다.</p></div><div><ul dir="auto">
<li data-line="0" dir="auto">요청 메시지 파싱 및 인코딩</li>
<li data-line="1" dir="auto">청크 단위 전송이 필요한 경우 바디를 청크 단위로 분할</li>
<li data-line="2" dir="auto">헤더 파싱 및 인코딩</li>
<li data-line="3" dir="auto">바디 파싱 및 인코딩</li>
<li data-line="4" dir="auto">인코딩된 데이터를 소켓의 버퍼에 저장 및 전송</li>
</ul></div><div class="heading-wrapper"><h4 data-heading="요청 메시지 파싱 및 인코딩" dir="auto" class="heading" id="요청_메시지_파싱_및_인코딩"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>요청 메시지 파싱 및 인코딩</h4><div class="heading-children"><div><p dir="auto">요청 메시지의 파싱은 아래 부분의 <code class="code-styler-inline">put_request</code> 에서 진행된다.</p></div><div><pre dir="auto" class="language-python" tabindex="0"><code class="language-python is-loaded"><span class="token keyword">if</span> headers <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
        headers <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
        header_keys <span class="token operator">=</span> <span class="token builtin">frozenset</span><span class="token punctuation">(</span>to_str<span class="token punctuation">(</span>k<span class="token punctuation">.</span>lower<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">for</span> k <span class="token keyword">in</span> headers<span class="token punctuation">)</span>
        skip_accept_encoding <span class="token operator">=</span> <span class="token string">"accept-encoding"</span> <span class="token keyword">in</span> header_keys
        skip_host <span class="token operator">=</span> <span class="token string">"host"</span> <span class="token keyword">in</span> header_keys
        self<span class="token punctuation">.</span>putrequest<span class="token punctuation">(</span>
            method<span class="token punctuation">,</span> url<span class="token punctuation">,</span> skip_accept_encoding<span class="token operator">=</span>skip_accept_encoding<span class="token punctuation">,</span> skip_host<span class="token operator">=</span>skip_host
        <span class="token punctuation">)</span>
</code><button class="copy-code-button">Copy</button></pre></div><div><p dir="auto"><code class="code-styler-inline">put_request</code>는 <code class="code-styler-inline">http.client</code>를 오버 라이딩하는 함수로 매개변수를 HTTP 요청 메시지 형태로 인코딩해 소켓 버퍼에 넣어준다. 이때 전송을 진행하지는 않고 버퍼에만 값을 보관한다는 것을 주의하자. 해당 함수를 수행하고 나면 아래와 같이 <strong><code class="code-styler-inline">Host</code> 헤더 정보 까지만 입력된 가장 기초적인 요청 메시지가 소켓 버퍼에 저장된다.</strong></p></div><div><pre dir="auto" class="language-http" tabindex="0"><code class="language-http is-loaded"><span class="token request-line"><span class="token method property">GET</span> <span class="token request-target url">/index.html</span> <span class="token http-version property">HTTP/1.1</span></span>
<span class="token header"><span class="token header-name keyword">Host</span><span class="token punctuation">:</span> <span class="token header-value">www.example.com</span></span>
</code><button class="copy-code-button">Copy</button></pre></div></div></div><div class="heading-wrapper"><h4 data-heading="청크 단위 전송이 필요한 경우 바디를 청크 단위로 분할" dir="auto" class="heading" id="청크_단위_전송이_필요한_경우_바디를_청크_단위로_분할"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>청크 단위 전송이 필요한 경우 바디를 청크 단위로 분할</h4><div class="heading-children"><div><p dir="auto">이후 만약 청크 단위의 전송이 필요하다면, 바디를 청크 단위로 분할하는 작업을 수행한다. 코드는 아래와 같다.</p></div><div><pre dir="auto" class="language-python" tabindex="0"><code class="language-python is-loaded">chunks_and_cl <span class="token operator">=</span> body_to_chunks<span class="token punctuation">(</span>body<span class="token punctuation">,</span> method<span class="token operator">=</span>method<span class="token punctuation">,</span> blocksize<span class="token operator">=</span>self<span class="token punctuation">.</span>blocksize<span class="token punctuation">)</span>
chunks <span class="token operator">=</span> chunks_and_cl<span class="token punctuation">.</span>chunks
content_length <span class="token operator">=</span> chunks_and_cl<span class="token punctuation">.</span>content_length

<span class="token comment"># When chunked is explicit set to 'True' we respect that.</span>
<span class="token keyword">if</span> chunked<span class="token punctuation">:</span>
	<span class="token keyword">if</span> <span class="token string">"transfer-encoding"</span> <span class="token keyword">not</span> <span class="token keyword">in</span> header_keys<span class="token punctuation">:</span>
		self<span class="token punctuation">.</span>putheader<span class="token punctuation">(</span><span class="token string">"Transfer-Encoding"</span><span class="token punctuation">,</span> <span class="token string">"chunked"</span><span class="token punctuation">)</span>
<span class="token keyword">else</span><span class="token punctuation">:</span>
	<span class="token comment"># Detect whether a framing mechanism is already in use. If so</span>
	<span class="token comment"># we respect that value, otherwise we pick chunked vs content-length</span>
	<span class="token comment"># depending on the type of 'body'.</span>
	<span class="token keyword">if</span> <span class="token string">"content-length"</span> <span class="token keyword">in</span> header_keys<span class="token punctuation">:</span>
		chunked <span class="token operator">=</span> <span class="token boolean">False</span>
	<span class="token keyword">elif</span> <span class="token string">"transfer-encoding"</span> <span class="token keyword">in</span> header_keys<span class="token punctuation">:</span>
		chunked <span class="token operator">=</span> <span class="token boolean">True</span>

	<span class="token comment"># Otherwise we go off the recommendation of 'body_to_chunks()'.</span>
	<span class="token keyword">else</span><span class="token punctuation">:</span>
		chunked <span class="token operator">=</span> <span class="token boolean">False</span>
		<span class="token keyword">if</span> content_length <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
			<span class="token keyword">if</span> chunks <span class="token keyword">is</span> <span class="token keyword">not</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
				chunked <span class="token operator">=</span> <span class="token boolean">True</span>
				self<span class="token punctuation">.</span>putheader<span class="token punctuation">(</span><span class="token string">"Transfer-Encoding"</span><span class="token punctuation">,</span> <span class="token string">"chunked"</span><span class="token punctuation">)</span>
		<span class="token keyword">else</span><span class="token punctuation">:</span>
			self<span class="token punctuation">.</span>putheader<span class="token punctuation">(</span><span class="token string">"Content-Length"</span><span class="token punctuation">,</span> <span class="token builtin">str</span><span class="token punctuation">(</span>content_length<span class="token punctuation">)</span><span class="token punctuation">)</span>

</code><button class="copy-code-button">Copy</button></pre></div><div><p dir="auto">함수는 사용자가 데이터를 전송한다고 가정할 때 분기를 크게 4가지로 구분한다.</p></div><div><ol dir="auto">
<li data-line="0" dir="auto"><div class="list-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>청크 단위로 분할 전송할 것을 명시한 경우
<ul dir="auto">
<li data-line="1" dir="auto">이 경우 <code class="code-styler-inline">Transfer-Encoding</code> 헤더를 추가한다.</li>
</ul>
</li>
<li data-line="2" dir="auto"><div class="list-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>Content-Length 헤더가 존재하는 경우
<ul dir="auto">
<li data-line="3" dir="auto">이 경우 청킹을 실시하지 않는다.</li>
</ul>
</li>
<li data-line="4" dir="auto"><div class="list-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>인코딩 헤더가 존재하는 경우
<ul dir="auto">
<li data-line="5" dir="auto">이 경우 청킹을 실시한다.</li>
</ul>
</li>
<li data-line="6" dir="auto"><div class="list-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>어떻게 전송할지 아무것도 명시하지 않은 경우
<ul dir="auto">
<li data-line="7" dir="auto">만약 바디의 크기를 특정할 수 없을 경우 청킹을 실시한다.</li>
</ul>
</li>
</ol></div><div><p dir="auto">4번의 경우만 좀 더 살펴보자. 4번 케이스로 넘어가려면 <code class="code-styler-inline">body_to_chunks</code>의 실행 결과에서 컨텐츠 길이가 None으로 도출돼야 한다. 아래는 <code class="code-styler-inline">body_to_chunks</code>의 코드이다.</p></div><div><pre dir="auto" class="language-python" tabindex="0"><code class="language-python is-loaded"><span class="token keyword">def</span> <span class="token function">body_to_chunks</span><span class="token punctuation">(</span>
    body<span class="token punctuation">:</span> typing<span class="token punctuation">.</span>Any <span class="token operator">|</span> <span class="token boolean">None</span><span class="token punctuation">,</span> method<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">,</span> blocksize<span class="token punctuation">:</span> <span class="token builtin">int</span>
<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> ChunksAndContentLength<span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""Takes the HTTP request method, body, and blocksize and
    transforms them into an iterable of chunks to pass to
    socket.sendall() and an optional 'Content-Length' header.

    A 'Content-Length' of 'None' indicates the length of the body
    can't be determined so should use 'Transfer-Encoding: chunked'
    for framing instead.
    """</span>

    chunks<span class="token punctuation">:</span> typing<span class="token punctuation">.</span>Iterable<span class="token punctuation">[</span><span class="token builtin">bytes</span><span class="token punctuation">]</span> <span class="token operator">|</span> <span class="token boolean">None</span>
    content_length<span class="token punctuation">:</span> <span class="token builtin">int</span> <span class="token operator">|</span> <span class="token boolean">None</span>

    <span class="token comment"># No body, we need to make a recommendation on 'Content-Length'</span>
    <span class="token comment"># based on whether that request method is expected to have</span>
    <span class="token comment"># a body or not.</span>
    <span class="token keyword">if</span> body <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
        chunks <span class="token operator">=</span> <span class="token boolean">None</span>
        <span class="token keyword">if</span> method<span class="token punctuation">.</span>upper<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">not</span> <span class="token keyword">in</span> _METHODS_NOT_EXPECTING_BODY<span class="token punctuation">:</span>
            content_length <span class="token operator">=</span> <span class="token number">0</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            content_length <span class="token operator">=</span> <span class="token boolean">None</span>

    <span class="token comment"># Bytes or strings become bytes</span>
    <span class="token keyword">elif</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>body<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">,</span> <span class="token builtin">bytes</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        chunks <span class="token operator">=</span> <span class="token punctuation">(</span>to_bytes<span class="token punctuation">(</span>body<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">)</span>
        content_length <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>chunks<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

    <span class="token comment"># File-like object, TODO: use seek() and tell() for length?</span>
    <span class="token keyword">elif</span> <span class="token builtin">hasattr</span><span class="token punctuation">(</span>body<span class="token punctuation">,</span> <span class="token string">"read"</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">def</span> <span class="token function">chunk_readable</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> typing<span class="token punctuation">.</span>Iterable<span class="token punctuation">[</span><span class="token builtin">bytes</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
            <span class="token keyword">nonlocal</span> body<span class="token punctuation">,</span> blocksize
            encode <span class="token operator">=</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>body<span class="token punctuation">,</span> io<span class="token punctuation">.</span>TextIOBase<span class="token punctuation">)</span>
            <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
                datablock <span class="token operator">=</span> body<span class="token punctuation">.</span>read<span class="token punctuation">(</span>blocksize<span class="token punctuation">)</span> <span class="token comment">#블락 사이즈로 파일을 끊어서 처리한다</span>
                <span class="token keyword">if</span> <span class="token keyword">not</span> datablock<span class="token punctuation">:</span>
                    <span class="token keyword">break</span>
                <span class="token keyword">if</span> encode<span class="token punctuation">:</span>
                    datablock <span class="token operator">=</span> datablock<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">"iso-8859-1"</span><span class="token punctuation">)</span>
                <span class="token keyword">yield</span> datablock <span class="token comment">#제네레이터로 데이터 블락을 계속 반환한다.</span>

        chunks <span class="token operator">=</span> chunk_readable<span class="token punctuation">(</span><span class="token punctuation">)</span>
        content_length <span class="token operator">=</span> <span class="token boolean">None</span>

    <span class="token comment"># Otherwise we need to start checking via duck-typing.</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        <span class="token keyword">try</span><span class="token punctuation">:</span>
            <span class="token comment"># Check if the body implements the buffer API.</span>
            mv <span class="token operator">=</span> <span class="token builtin">memoryview</span><span class="token punctuation">(</span>body<span class="token punctuation">)</span>
        <span class="token keyword">except</span> TypeError<span class="token punctuation">:</span>
            <span class="token keyword">try</span><span class="token punctuation">:</span>
                <span class="token comment"># Check if the body is an iterable</span>
                chunks <span class="token operator">=</span> <span class="token builtin">iter</span><span class="token punctuation">(</span>body<span class="token punctuation">)</span>
                content_length <span class="token operator">=</span> <span class="token boolean">None</span>
            <span class="token keyword">except</span> TypeError<span class="token punctuation">:</span>
                <span class="token keyword">raise</span> TypeError<span class="token punctuation">(</span>
                    <span class="token string-interpolation"><span class="token string">f"'body' must be a bytes-like object, file-like "</span></span>
                    <span class="token string-interpolation"><span class="token string">f"object, or iterable. Instead was </span><span class="token interpolation"><span class="token punctuation">{</span>body<span class="token conversion-option punctuation">!r</span><span class="token punctuation">}</span></span><span class="token string">"</span></span>
                <span class="token punctuation">)</span> <span class="token keyword">from</span> <span class="token boolean">None</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            <span class="token comment"># Since it implements the buffer API can be passed directly to socket.sendall()</span>
            chunks <span class="token operator">=</span> <span class="token punctuation">(</span>body<span class="token punctuation">,</span><span class="token punctuation">)</span>
            content_length <span class="token operator">=</span> mv<span class="token punctuation">.</span>nbytes

    <span class="token keyword">return</span> ChunksAndContentLength<span class="token punctuation">(</span>chunks<span class="token operator">=</span>chunks<span class="token punctuation">,</span> content_length<span class="token operator">=</span>content_length<span class="token punctuation">)</span>
</code><button class="copy-code-button">Copy</button></pre></div><div><p dir="auto">컨텐츠 길이가 None으로 설정되는 경우는 다음과 같다.</p></div><div><ol dir="auto">
<li data-line="0" dir="auto">메서드가 바디가 존재하지 않는 GET, HEAD 등의 메서드인 경우</li>
<li data-line="1" dir="auto">전송 하려는 데이터가 길이를 곧장 특정할 수 없는 파일 비슷한 타입인 경우</li>
<li data-line="2" dir="auto">바디가 메모리 뷰 타입을 지원하지 않는 이터러블 객체인 경우 (이 경우 바디의 크기를 곧장 측정할 수 없다)</li>
</ol></div><div><p dir="auto">다시 <code class="code-styler-inline">request</code> 함수로 돌아가보면 <strong>청크 할게 없는 1번의 경우를 제외하고 2,3의 경우 청킹을 적용해서 메시지를 전송하는 것을 확인할 수 있다.</strong> </p></div><div><pre dir="auto" class="language-python" tabindex="0"><code class="language-python is-loaded">	<span class="token comment"># Otherwise we go off the recommendation of 'body_to_chunks()'.</span>
	<span class="token keyword">else</span><span class="token punctuation">:</span>
		chunked <span class="token operator">=</span> <span class="token boolean">False</span>
		<span class="token keyword">if</span> content_length <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
			<span class="token keyword">if</span> chunks <span class="token keyword">is</span> <span class="token keyword">not</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
				chunked <span class="token operator">=</span> <span class="token boolean">True</span>
				self<span class="token punctuation">.</span>putheader<span class="token punctuation">(</span><span class="token string">"Transfer-Encoding"</span><span class="token punctuation">,</span> <span class="token string">"chunked"</span><span class="token punctuation">)</span>
		<span class="token keyword">else</span><span class="token punctuation">:</span> <span class="token comment">#컨텐츠의 길이를 명확히 파악한 경우</span>
			self<span class="token punctuation">.</span>putheader<span class="token punctuation">(</span><span class="token string">"Content-Length"</span><span class="token punctuation">,</span> <span class="token builtin">str</span><span class="token punctuation">(</span>content_length<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code><button class="copy-code-button">Copy</button></pre></div><div><p dir="auto">흥미롭게 생각해 볼만한 부분은 아래의 부분인데, 전송할 바디의 크기를 명확히 파악하지 못해 청킹으로 전송하는 방식을 길이를 명확히 파악해 전송하는 방식으로 변환하고자 하는 TODO가 작성 돼있다.</p></div><div><pre dir="auto" class="language-python" tabindex="0"><code class="language-python is-loaded">    <span class="token comment"># File-like object, TODO: use seek() and tell() for length?</span>
    <span class="token keyword">elif</span> <span class="token builtin">hasattr</span><span class="token punctuation">(</span>body<span class="token punctuation">,</span> <span class="token string">"read"</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">def</span> <span class="token function">chunk_readable</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> typing<span class="token punctuation">.</span>Iterable<span class="token punctuation">[</span><span class="token builtin">bytes</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
            <span class="token keyword">nonlocal</span> body<span class="token punctuation">,</span> blocksize
            encode <span class="token operator">=</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>body<span class="token punctuation">,</span> io<span class="token punctuation">.</span>TextIOBase<span class="token punctuation">)</span>
            <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
                datablock <span class="token operator">=</span> body<span class="token punctuation">.</span>read<span class="token punctuation">(</span>blocksize<span class="token punctuation">)</span>
                <span class="token keyword">if</span> <span class="token keyword">not</span> datablock<span class="token punctuation">:</span>
                    <span class="token keyword">break</span>
                <span class="token keyword">if</span> encode<span class="token punctuation">:</span>
                    datablock <span class="token operator">=</span> datablock<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">"iso-8859-1"</span><span class="token punctuation">)</span>
                <span class="token keyword">yield</span> datablock <span class="token comment">#제네레이터로 데이터 블락을 계속 반환한다.</span>

        chunks <span class="token operator">=</span> chunk_readable<span class="token punctuation">(</span><span class="token punctuation">)</span>
        content_length <span class="token operator">=</span> <span class="token boolean">None</span>
</code><button class="copy-code-button">Copy</button></pre></div><div><hr dir="auto"></div></div></div></div></div><div class="heading-wrapper"><h3 data-heading="답답해서 내가 뛴다 청킹 고쳐보기" dir="auto" class="heading" id="답답해서_내가_뛴다_청킹_고쳐보기"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>답답해서 내가 뛴다 청킹 고쳐보기</h3><div class="heading-children"><div><p dir="auto">청킹 로직을 보며 느낀 가장 큰 문제점은 코드가 예상한대로 동작하지 않는다는 것이였다. 위의 청킹 로직을 보면 c<strong>hunked 파라미터의 값이 false로 설정돼도 Contents-Length 헤더가 명시 돼있지 않으면 자동적으로 청킹을 진행하는 방식으로 동작</strong>한다.</p></div><div><p dir="auto">이는 모호한 동작이므로 chunked 파라미터의 값이 false로 설정돼 있을 경우 자동적으로 전송 하려는 데이터의 크기를 측정한 후 Contents-Length를 활용해 통신하는 방식으로 코드를 수정했다. 아래는 수정된 코드이다.</p></div><div><pre dir="auto" class="language-python" tabindex="0"><code class="language-python is-loaded"><span class="token keyword">def</span> <span class="token function">request</span><span class="token punctuation">(</span>  <span class="token comment"># type: ignore[override]</span>
        self<span class="token punctuation">,</span>
        method<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">,</span>
        url<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">,</span>
        body<span class="token punctuation">:</span> _TYPE_BODY <span class="token operator">|</span> <span class="token boolean">None</span> <span class="token operator">=</span> <span class="token boolean">None</span><span class="token punctuation">,</span>
        headers<span class="token punctuation">:</span> typing<span class="token punctuation">.</span>Mapping<span class="token punctuation">[</span><span class="token builtin">str</span><span class="token punctuation">,</span> <span class="token builtin">str</span><span class="token punctuation">]</span> <span class="token operator">|</span> <span class="token boolean">None</span> <span class="token operator">=</span> <span class="token boolean">None</span><span class="token punctuation">,</span>
        <span class="token operator">*</span><span class="token punctuation">,</span>
        chunked<span class="token punctuation">:</span> <span class="token builtin">bool</span> <span class="token operator">=</span> <span class="token boolean">False</span><span class="token punctuation">,</span>
        preload_content<span class="token punctuation">:</span> <span class="token builtin">bool</span> <span class="token operator">=</span> <span class="token boolean">True</span><span class="token punctuation">,</span>
        decode_content<span class="token punctuation">:</span> <span class="token builtin">bool</span> <span class="token operator">=</span> <span class="token boolean">True</span><span class="token punctuation">,</span>
        enforce_content_length<span class="token punctuation">:</span> <span class="token builtin">bool</span> <span class="token operator">=</span> <span class="token boolean">True</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
        <span class="token comment"># Update the inner socket's timeout value to send the request.</span>
        <span class="token comment"># This only triggers if the connection is re-used.</span>
        <span class="token keyword">if</span> self<span class="token punctuation">.</span>sock <span class="token keyword">is</span> <span class="token keyword">not</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>sock<span class="token punctuation">.</span>settimeout<span class="token punctuation">(</span>self<span class="token punctuation">.</span>timeout<span class="token punctuation">)</span>

        <span class="token comment"># Store these values to be fed into the HTTPResponse</span>
        <span class="token comment"># object later. TODO: Remove this in favor of a real</span>
        <span class="token comment"># HTTP lifecycle mechanism.</span>

        <span class="token comment"># We have to store these before we call .request()</span>
        <span class="token comment"># because sometimes we can still salvage a response</span>
        <span class="token comment"># off the wire even if we aren't able to completely</span>
        <span class="token comment"># send the request body.</span>
        self<span class="token punctuation">.</span>_response_options <span class="token operator">=</span> _ResponseOptions<span class="token punctuation">(</span>
            request_method<span class="token operator">=</span>method<span class="token punctuation">,</span>
            request_url<span class="token operator">=</span>url<span class="token punctuation">,</span>
            preload_content<span class="token operator">=</span>preload_content<span class="token punctuation">,</span>
            decode_content<span class="token operator">=</span>decode_content<span class="token punctuation">,</span>
            enforce_content_length<span class="token operator">=</span>enforce_content_length<span class="token punctuation">,</span>
        <span class="token punctuation">)</span>

        <span class="token keyword">if</span> headers <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
            headers <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
        header_keys <span class="token operator">=</span> <span class="token builtin">frozenset</span><span class="token punctuation">(</span>to_str<span class="token punctuation">(</span>k<span class="token punctuation">.</span>lower<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">for</span> k <span class="token keyword">in</span> headers<span class="token punctuation">)</span>
        skip_accept_encoding <span class="token operator">=</span> <span class="token string">"accept-encoding"</span> <span class="token keyword">in</span> header_keys
        skip_host <span class="token operator">=</span> <span class="token string">"host"</span> <span class="token keyword">in</span> header_keys
        self<span class="token punctuation">.</span>putrequest<span class="token punctuation">(</span>
            method<span class="token punctuation">,</span> url<span class="token punctuation">,</span> skip_accept_encoding<span class="token operator">=</span>skip_accept_encoding<span class="token punctuation">,</span> skip_host<span class="token operator">=</span>skip_host
        <span class="token punctuation">)</span>
        <span class="token comment"># The body is sent by content-length header when chunked is False or</span>
        <span class="token comment"># transfer-encoding header doesn't exist.</span>
        <span class="token comment"># The sending header is only affected by chunked parameter or header</span>
        <span class="token comment"># type of body doesn't affect to header.</span>

        <span class="token keyword">if</span> <span class="token string">"content-length"</span> <span class="token keyword">in</span> header_keys<span class="token punctuation">:</span>
            chunked <span class="token operator">=</span> <span class="token boolean">False</span>

        <span class="token keyword">elif</span> <span class="token string">"transfer-encoding"</span> <span class="token keyword">in</span> header_keys<span class="token punctuation">:</span>
            chunked <span class="token operator">=</span> <span class="token boolean">True</span>

        chunks_and_cl <span class="token operator">=</span> <span class="token boolean">None</span>
        content_length <span class="token operator">=</span> <span class="token boolean">None</span>

        <span class="token comment"># Transform the body into an iterable of sendall()-able chunks</span>

        <span class="token comment"># If No body, we need to make a recommendation on 'Content-Length'</span>
        <span class="token comment"># based on whether that request method is expected to have</span>
        <span class="token comment"># a body or not.</span>

        <span class="token keyword">if</span> body <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
            <span class="token keyword">if</span> method<span class="token punctuation">.</span>upper<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">not</span> <span class="token keyword">in</span> _METHODS_NOT_EXPECTING_BODY<span class="token punctuation">:</span>
                content_length <span class="token operator">=</span> <span class="token number">0</span>

        <span class="token keyword">elif</span> chunked<span class="token punctuation">:</span>
            chunks_and_cl <span class="token operator">=</span> body_to_chunks<span class="token punctuation">(</span>body<span class="token punctuation">,</span> self<span class="token punctuation">.</span>blocksize<span class="token punctuation">)</span>  <span class="token comment"># use chunking</span>

        <span class="token keyword">else</span><span class="token punctuation">:</span>
            chunks_and_cl <span class="token operator">=</span> body_to_bytes<span class="token punctuation">(</span>body<span class="token punctuation">,</span> self<span class="token punctuation">.</span>blocksize<span class="token punctuation">)</span>
            content_length <span class="token operator">=</span> chunks_and_cl<span class="token punctuation">.</span>content_length

        <span class="token comment"># Now that framing headers are out of the way we send all the other headers.</span>
        <span class="token keyword">if</span> <span class="token string">"user-agent"</span> <span class="token keyword">not</span> <span class="token keyword">in</span> header_keys<span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>putheader<span class="token punctuation">(</span><span class="token string">"User-Agent"</span><span class="token punctuation">,</span> _get_default_user_agent<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

        <span class="token comment"># Detect whether a framing mechanism is already in use. If so we respect that value.</span>
        <span class="token keyword">if</span> chunked <span class="token keyword">and</span> <span class="token string">"transfer-encoding"</span> <span class="token keyword">not</span> <span class="token keyword">in</span> header_keys<span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>putheader<span class="token punctuation">(</span><span class="token string">"Transfer-Encoding"</span><span class="token punctuation">,</span> <span class="token string">"chunked"</span><span class="token punctuation">)</span>

        <span class="token keyword">elif</span> content_length <span class="token keyword">is</span> <span class="token keyword">not</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>putheader<span class="token punctuation">(</span><span class="token string">"Content-Length"</span><span class="token punctuation">,</span> <span class="token builtin">str</span><span class="token punctuation">(</span>content_length<span class="token punctuation">)</span><span class="token punctuation">)</span>

        <span class="token keyword">for</span> header<span class="token punctuation">,</span> value <span class="token keyword">in</span> headers<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>putheader<span class="token punctuation">(</span>header<span class="token punctuation">,</span> value<span class="token punctuation">)</span>

        self<span class="token punctuation">.</span>endheaders<span class="token punctuation">(</span><span class="token punctuation">)</span>

        <span class="token keyword">if</span> chunks_and_cl<span class="token punctuation">:</span>
            chunks <span class="token operator">=</span> chunks_and_cl<span class="token punctuation">.</span>chunks

            <span class="token comment"># If we're given a body we start sending that in chunks.</span>
            <span class="token keyword">for</span> chunk <span class="token keyword">in</span> chunks<span class="token punctuation">:</span>
                <span class="token comment"># Sending empty chunks isn't allowed for TE: chunked</span>
                <span class="token comment"># as it indicates the end of the body.</span>
                <span class="token keyword">if</span> <span class="token keyword">not</span> chunk<span class="token punctuation">:</span>
                    <span class="token keyword">continue</span>
                <span class="token keyword">if</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>chunk<span class="token punctuation">,</span> <span class="token builtin">str</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                    chunk <span class="token operator">=</span> chunk<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">"utf-8"</span><span class="token punctuation">)</span>
                <span class="token keyword">if</span> chunked<span class="token punctuation">:</span>
                    self<span class="token punctuation">.</span>send<span class="token punctuation">(</span><span class="token string">b"%x\r\n%b\r\n"</span> <span class="token operator">%</span> <span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>chunk<span class="token punctuation">)</span><span class="token punctuation">,</span> chunk<span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token keyword">else</span><span class="token punctuation">:</span>
                    self<span class="token punctuation">.</span>send<span class="token punctuation">(</span>chunk<span class="token punctuation">)</span>

        <span class="token comment"># Regardless of whether we have a body or not, if we're in</span>
        <span class="token comment"># chunked mode we want to send an explicit empty chunk.</span>
        <span class="token keyword">if</span> chunked<span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>send<span class="token punctuation">(</span><span class="token string">b"0\r\n\r\n"</span><span class="token punctuation">)</span>

</code><button class="copy-code-button">Copy</button></pre></div><div><p dir="auto">수정을 통해 개선하고 싶었던 점은 추측을 통해 청킹을 진행하는 현상 제거하고 유저가 명시한 경우에만 진행하는 것이다. <strong>즉, chunked라고 명확히 주어진 매개변수 값을 활용해서만 청킹의 진행 여부를 판단하게 하는 것이 이번 수정의 가장 큰 목표</strong>였다.</p></div><div><p dir="auto">이러한 수정을 진행하게 된 계기는 명확 했는데, 컨텐츠 길이를 파악할 수 있다면, 청킹보다 데이터를 덩어리로 한번에 던지는 것이 대부분 더욱 효율적이기 때문이다. (<a data-href="HTTP Chunk VS Content-Length" href="network/http-chunk-vs-content-length.html" class="internal-link" target="_self" rel="noopener">HTTP Chunk VS Content-Length</a>)</p></div><div><p dir="auto">이를 구현하기 위해 수정한 부분은 단순했다. 우선 청킹을 추측하는 로직을 제거했다.</p></div><div><pre dir="auto" class="language-python" tabindex="0"><code class="language-python is-loaded"><span class="token keyword">if</span> body <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
	<span class="token keyword">if</span> method<span class="token punctuation">.</span>upper<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">not</span> <span class="token keyword">in</span> _METHODS_NOT_EXPECTING_BODY<span class="token punctuation">:</span>
			content_length <span class="token operator">=</span> <span class="token number">0</span>

	<span class="token keyword">elif</span> chunked<span class="token punctuation">:</span>
		chunks_and_cl <span class="token operator">=</span> body_to_chunks<span class="token punctuation">(</span>body<span class="token punctuation">,</span> self<span class="token punctuation">.</span>blocksize<span class="token punctuation">)</span>  <span class="token comment"># use chunking</span>

	<span class="token keyword">else</span><span class="token punctuation">:</span>
		chunks_and_cl <span class="token operator">=</span> body_to_bytes<span class="token punctuation">(</span>body<span class="token punctuation">,</span> self<span class="token punctuation">.</span>blocksize<span class="token punctuation">)</span>
		content_length <span class="token operator">=</span> chunks_and_cl<span class="token punctuation">.</span>content_length

</code><button class="copy-code-button">Copy</button></pre></div><div><p dir="auto">이전의 코드와 달리 청킹 값이 참으로 설정돼 있는 경우에만 청킹을 진행하고 아닐 경우 전송 하려는 파일의 크기를 측정하는 코드를 작성했다. 이제 chunked 변수의 값이 실제 청킹 여부를 결정한다.</p></div><div><p dir="auto">이외에는 파일의 크기를 측정하는 부분을 구현할 필요가 있다.</p></div><div><pre dir="auto" class="language-python" tabindex="0"><code class="language-python is-loaded"><span class="token keyword">def</span> <span class="token function">chunk_readable</span><span class="token punctuation">(</span>body<span class="token punctuation">:</span> typing<span class="token punctuation">.</span>Any<span class="token punctuation">,</span> blocksize<span class="token punctuation">:</span> <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span>typing<span class="token punctuation">.</span>Iterable<span class="token punctuation">[</span><span class="token builtin">bytes</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
    <span class="token comment">#Get file content length</span>
    encode <span class="token operator">=</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>body<span class="token punctuation">,</span> io<span class="token punctuation">.</span>TextIOBase<span class="token punctuation">)</span>
    <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
        datablock <span class="token operator">=</span> body<span class="token punctuation">.</span>read<span class="token punctuation">(</span>blocksize<span class="token punctuation">)</span>
        <span class="token keyword">if</span> <span class="token keyword">not</span> datablock<span class="token punctuation">:</span>
            <span class="token keyword">break</span>
        <span class="token keyword">if</span> encode<span class="token punctuation">:</span>
            datablock <span class="token operator">=</span> datablock<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">"iso-8859-1"</span><span class="token punctuation">)</span>
        <span class="token keyword">yield</span> datablock

<span class="token keyword">def</span> <span class="token function">body_to_bytes</span><span class="token punctuation">(</span>body<span class="token punctuation">:</span> typing<span class="token punctuation">.</span>Any<span class="token punctuation">,</span> blocksize<span class="token punctuation">:</span> <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> ChunksAndContentLength<span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""Convert body data to sendable bytes and measures the length of it.
    If body is iterable data then iter whole data and buffer it.
    """</span>

    <span class="token keyword">if</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>body<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">,</span> <span class="token builtin">bytes</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        chunks <span class="token operator">=</span> <span class="token punctuation">(</span>to_bytes<span class="token punctuation">(</span>body<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">)</span>
        content_length <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>chunks<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

    <span class="token keyword">elif</span> <span class="token builtin">hasattr</span><span class="token punctuation">(</span>body<span class="token punctuation">,</span> <span class="token string">"read"</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        chunks <span class="token operator">=</span> <span class="token builtin">bytearray</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">for</span> chunk <span class="token keyword">in</span> chunk_readable<span class="token punctuation">(</span>body<span class="token punctuation">,</span> blocksize<span class="token punctuation">)</span><span class="token punctuation">:</span>
            chunks <span class="token operator">+=</span> chunk

        chunks <span class="token operator">=</span> <span class="token punctuation">(</span>chunks<span class="token punctuation">,</span><span class="token punctuation">)</span>
        content_length <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>chunks<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

    <span class="token keyword">elif</span> <span class="token builtin">hasattr</span><span class="token punctuation">(</span>body<span class="token punctuation">,</span> <span class="token string">"__next__"</span><span class="token punctuation">)</span><span class="token punctuation">:</span>  <span class="token comment"># check iterator type</span>
        chunks <span class="token operator">=</span> <span class="token builtin">bytearray</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">for</span> chunk <span class="token keyword">in</span> body<span class="token punctuation">:</span>
            <span class="token keyword">try</span><span class="token punctuation">:</span>
                chunks <span class="token operator">+=</span> chunk
            <span class="token keyword">except</span> TypeError<span class="token punctuation">:</span>
                <span class="token comment"># if chunk is not byte</span>
                <span class="token keyword">raise</span> TypeError<span class="token punctuation">(</span>
                    <span class="token string-interpolation"><span class="token string">f"'body' must be a bytes-like object, file-like "</span></span>
                    <span class="token string-interpolation"><span class="token string">f"object, or iterable. Instead was </span><span class="token interpolation"><span class="token punctuation">{</span>body<span class="token conversion-option punctuation">!r</span><span class="token punctuation">}</span></span><span class="token string">"</span></span>
                <span class="token punctuation">)</span> <span class="token keyword">from</span> <span class="token boolean">None</span>

        chunks <span class="token operator">=</span> <span class="token punctuation">(</span>chunks<span class="token punctuation">,</span><span class="token punctuation">)</span>
        content_length <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>chunks<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

    <span class="token keyword">else</span><span class="token punctuation">:</span>
        <span class="token comment"># Otherwise we need to start checking via duck-typing.</span>
        <span class="token keyword">try</span><span class="token punctuation">:</span>
            mv <span class="token operator">=</span> <span class="token builtin">memoryview</span><span class="token punctuation">(</span>body<span class="token punctuation">)</span>
            chunks <span class="token operator">=</span> <span class="token punctuation">(</span>body<span class="token punctuation">,</span><span class="token punctuation">)</span>
            content_length <span class="token operator">=</span> mv<span class="token punctuation">.</span>nbytes
        <span class="token keyword">except</span> TypeError<span class="token punctuation">:</span>
            <span class="token keyword">raise</span> TypeError<span class="token punctuation">(</span>
                <span class="token string-interpolation"><span class="token string">f"'body' must be a bytes-like object, file-like "</span></span>
                <span class="token string-interpolation"><span class="token string">f"object, or iterable. Instead was </span><span class="token interpolation"><span class="token punctuation">{</span>body<span class="token conversion-option punctuation">!r</span><span class="token punctuation">}</span></span><span class="token string">"</span></span>
            <span class="token punctuation">)</span> <span class="token keyword">from</span> <span class="token boolean">None</span>

    <span class="token keyword">return</span> ChunksAndContentLength<span class="token punctuation">(</span>chunks<span class="token operator">=</span>chunks<span class="token punctuation">,</span> content_length<span class="token operator">=</span>content_length<span class="token punctuation">)</span>

</code><button class="copy-code-button">Copy</button></pre></div><div><p dir="auto">제네레이터를 활용해 바이트를 청크 단위로 잘라가며 파일을 읽고 이후 전체 길이를 측정해 반환하는 함수이다. 이후 해당 길이를 활용해 파일을 길이만큼 읽고 전송을 하는 방식으로 처리한다.</p></div><div><hr dir="auto"></div></div></div><div class="heading-wrapper"><h3 data-heading="결과" dir="auto" class="heading" id="결과"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>결과</h3><div class="heading-children"><div><p dir="auto">코드 자체는 큰 문제가 없다. 테스트도 잘 통과하고 큰 이슈도 존재하지 않는다. <strong>문제는 이를 반영할 경우 다른 라이브러리나 시스템에 혼란을 줄 수 있다는 것이다. 기존의 청킹을 기본적으로 실행하던 방식에서 이러한 방식으로 변경할 경우 큰 크기의 파일을 전송하는 서버의 경우 메모리에서 이슈가 발생할 수도 있다.</strong></p></div><div><p dir="auto">실제로 이슈를 리젝먹은 이유를 살펴보면 이와 같은 내용들이 내포 돼 있다. <a data-tooltip-position="top" aria-label="https://github.com/urllib3/urllib3/issues/3379" rel="noopener" class="external-link" href="https://github.com/urllib3/urllib3/issues/3379" target="_blank">이슈</a></p></div><div class="mod-footer"></div></div></div></div></div></div><div class="sidebar-right sidebar"><div class="sidebar-handle"></div><div class="sidebar-topbar"><div class="topbar-content"></div><div class="clickable-icon sidebar-collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="100%" height="100%" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" class="svg-icon"><path d="M21 3H3C1.89543 3 1 3.89543 1 5V19C1 20.1046 1.89543 21 3 21H21C22.1046 21 23 20.1046 23 19V5C23 3.89543 22.1046 3 21 3Z"></path><path d="M10 4V20"></path><path d="M4 7H7"></path><path d="M4 10H7"></path><path d="M4 13H7"></path></svg></div></div><div class="sidebar-content"><div class="graph-view-wrapper"><div class="sidebar-section-header">Interactive Graph</div><div class="graph-view-placeholder">
		<div class="graph-view-container">
			<div class="graph-icon graph-expand" role="button" aria-label="Expand" data-tooltip-position="top"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon"><line x1="7" y1="17" x2="17" y2="7"></line><polyline points="7 7 17 7 17 17"></polyline></svg></div>
			<canvas id="graph-canvas" class="hide" width="512px" height="512px"></canvas>
		</div>
		</div></div><div class="tree-container mod-root nav-folder tree-item outline-tree" data-depth="0"><div class="tree-header"><span class="sidebar-section-header">Table Of Contents</span><button class="clickable-icon collapse-tree-button" aria-label="Collapse All"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></svg></button></div><div class="tree-scroll-area tree-item-children nav-folder-children"><div class="tree-item mod-tree-folder nav-folder mod-collapsible is-collapsed" style="display: none;"></div><div class="tree-item" data-depth="1"><a class="tree-link" href="opensource/urllib3/http-connection-딮다이브-(2).html#HTTP Connection 딮다이브 (2)"><div class="tree-item-contents heading-link" heading-name="HTTP Connection 딮다이브 (2)"><span class="tree-item-title">HTTP Connection 딮다이브 (2)</span></div></a><div class="tree-item-children nav-folder-children"><div class="tree-item" data-depth="3"><a class="tree-link" href="opensource/urllib3/http-connection-딮다이브-(2).html#HTTPConnection"><div class="tree-item-contents heading-link" heading-name="HTTPConnection"><span class="tree-item-title">HTTPConnection</span></div></a><div class="tree-item-children nav-folder-children"></div></div><div class="tree-item" data-depth="3"><a class="tree-link" href="opensource/urllib3/http-connection-딮다이브-(2).html#연결을_어떻게_생성하는가?"><div class="tree-item-contents heading-link" heading-name="연결을 어떻게 생성하는가?"><span class="tree-item-title">연결을 어떻게 생성하는가?</span></div></a><div class="tree-item-children nav-folder-children"></div></div><div class="tree-item" data-depth="3"><a class="tree-link" href="opensource/urllib3/http-connection-딮다이브-(2).html#HTTP_Connection의_메시지_전송"><div class="tree-item-contents heading-link" heading-name="HTTP Connection의 메시지 전송"><span class="tree-item-title">HTTP Connection의 메시지 전송</span></div></a><div class="tree-item-children nav-folder-children"></div></div><div class="tree-item" data-depth="4"><a class="tree-link" href="opensource/urllib3/http-connection-딮다이브-(2).html#요청_메시지_파싱_및_인코딩"><div class="tree-item-contents heading-link" heading-name="요청 메시지 파싱 및 인코딩"><span class="tree-item-title">요청 메시지 파싱 및 인코딩</span></div></a><div class="tree-item-children nav-folder-children"></div></div><div class="tree-item" data-depth="4"><a class="tree-link" href="opensource/urllib3/http-connection-딮다이브-(2).html#청크_단위_전송이_필요한_경우_바디를_청크_단위로_분할"><div class="tree-item-contents heading-link" heading-name="청크 단위 전송이 필요한 경우 바디를 청크 단위로 분할"><span class="tree-item-title">청크 단위 전송이 필요한 경우 바디를 청크 단위로 분할</span></div></a><div class="tree-item-children nav-folder-children"></div></div><div class="tree-item" data-depth="3"><a class="tree-link" href="opensource/urllib3/http-connection-딮다이브-(2).html#답답해서_내가_뛴다_청킹_고쳐보기"><div class="tree-item-contents heading-link" heading-name="답답해서 내가 뛴다 청킹 고쳐보기"><span class="tree-item-title">답답해서 내가 뛴다 청킹 고쳐보기</span></div></a><div class="tree-item-children nav-folder-children"></div></div><div class="tree-item" data-depth="3"><a class="tree-link" href="opensource/urllib3/http-connection-딮다이브-(2).html#결과"><div class="tree-item-contents heading-link" heading-name="결과"><span class="tree-item-title">결과</span></div></a><div class="tree-item-children nav-folder-children"></div></div></div></div></div></div></div><script defer="">let rs = document.querySelector(".sidebar-right"); rs.classList.add("is-collapsed"); if (window.innerWidth > 768) rs.classList.remove("is-collapsed"); rs.style.setProperty("--sidebar-width", localStorage.getItem("sidebar-right-width"));</script></div></div></body></html>